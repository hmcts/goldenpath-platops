<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Lab Repository and Pipeline - HMCTS</title>

    <link href="../stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://hmcts-platops-goldenpath.github.io//Walkthrough/prereq.html">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="hmcts-platops-goldenpath.github.io" />
      <meta name="twitter:image" content="https://hmcts-platops-goldenpath.github.io//images/govuk-large.png" />
      <meta name="twitter:title" content="Lab Repository and Pipeline - HMCTS" />
      <meta name="twitter:url" content="https://hmcts-platops-goldenpath.github.io//Walkthrough/prereq.html" />

      <meta property="og:image" content="https://hmcts-platops-goldenpath.github.io//images/govuk-large.png" />
      <meta property="og:site_name" content="HMCTS" />
      <meta property="og:title" content="Lab Repository and Pipeline" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://hmcts-platops-goldenpath.github.io//Walkthrough/prereq.html" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="https://github.com/hmcts" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          HMCTS
        </span>
      </a>
        <strong class="govuk-tag">Live</strong>
    </div>
    <div class="govuk-header__content">
      <nav class="govuk-header__navigation govuk-header__navigation--end" aria-label="Menu">
        <button type="button" class="govuk-header__menu-button govuk-js-header-toggle" aria-controls="navigation" aria-label="Show or hide menu">Menu</button>
        <ul id="navigation" class="govuk-header__navigation-list">
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://hmcts-dts.slack.com/app_redirect?channel=platops-help">Support</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="../">Documentation</a>
            </li>
            <li class="govuk-header__navigation-item">
              <a class="govuk-header__link" href="https://github.com/hmcts">GitHub</a>
            </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search" data-path-to-site-root="../">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://hmcts-platops-goldenpath.github.io/"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading" data-module="collapsible-navigation">
                      <ul>
  <li>
    <a href="../index.html"><span>GoldenPath PlatOps</span></a>
  </li>
<li><a href="../Walkthrough/index.html"><span>Walkthrough</span></a>
<ul>
  <li>
    <a href="../Walkthrough/prereq.html"><span>Prereq - CI/CD and SVC</span></a>
  </li>
  <li>
    <a href="../Walkthrough/virtual-networks.html"><span>Section 1 - Virtual Networks</span></a>
  </li>
  <li>
    <a href="../Walkthrough/aks-cluster.html"><span>Section 2 - AKS Cluster</span></a>
  </li>
  <li>
    <a href="../Walkthrough/clean-up.html"><span>Section 3 - Clean Up</span></a>
  </li>
  <li>
    <a href="../Walkthrough/futher-steps.html"><span>Section 4 - Further Steps</span></a>
  </li>
</ul>
</li>
<li><a href="../Technical Documantaion/index.html"><span>Technical Documentation</span></a>
<ul>
  <li>
    <a href="../Technical Documantaion/1-clusters"><span>The AKS Cluster</span></a>
  </li>
  <li>
    <a href="../Technical Documantaion/3-frontdoor"><span>Azure Frontdoor</span></a>
  </li>
  <li>
    <a href="../Technical Documantaion/2-firewalls"><span>Firewalls</span></a>
  </li>
  <li>
    <a href="../Technical Documantaion/4-logs"><span>Logs</span></a>
  </li>
  <li>
    <a href="../Technical Documantaion/5-dns"><span>DNS</span></a>
  </li>
</ul>
</li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled" aria-label="Content" tabindex="0">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
            <h1 id="prereq-ci-cd-and-svc">Prereq - CI/CD and SVC</h1>
<p>If these terms are alien to you, this would be a good time to take a pause, grab your favourite beverage and have a read of the follow documentation</p>

<ul>
<li><a href="https://docs.github.com/en/get-started/using-git/about-git">SVC</a></li>
<li><a href="https://learn.microsoft.com/en-us/azure/devops/pipelines/apps/cd/azure/cicd-data-overview?view=azure-devops">CI/CD</a></li>
</ul>
<p>With that out of the way, the first thing we&rsquo;ll need to get setup for the labs is a pipeline as all your code would need to
run somewhere.</p>
<p>While we can execute our terraform code manually, as explained in the next section and mainly in lab environments or personal cloud accounts, we
advice that you stick to having your code in a git repo in your live environments.</p>
<p>This section will introduce you to our <a href="https://github.com/hmcts">Git</a> repo and <a href="https://dev.azure.com/hmcts">Azure DevOps</a> pipelines, we know you will need to visit Git and Azure pipelines like everyday so we
might as well get started with that.</p>
<h2 id="lab-git-repo">Lab Git Repo</h2>
<p>Platform Operations uses Git for it&rsquo;s source control. To create a repo for your lab, follow the steps below</p>

<ul>
<li>Navigate to the <a href="https://github.com/hmcts">HMCTS</a> git organisations page. If you dont already have access you can
double check the <a href="https://turbo-fiesta-ov7yye3.pages.github.io/onboarding/index.html">Onboarding Checklist</a> to make sure you have the right access.
You can also speak to a team member to assist if needed. <a href="https://hmcts-reform.slack.com/archives/C01APTJAM7D">#platform-operations</a></li>
<li><p>Create a new git repo. Call this repo <code>lab-yourname-goldenpath</code>. You can follow this convention in other sections of this exercise as this makes it easier to when cleaning up resources after the labs.</p>

<details>
  <summary>Create new Git repo</summary>
  <img alt="Createnew Git repo" src="./images/new-git-repo.png" width="auto">
</details></li>
</ul>
<p>ðŸ”” In a production environment you will need to update your new repository&rsquo;s settings to allow merging to <code>master</code> | <code>main</code> only from a branch PR and also to require at least 1 reviewer for PR&rsquo;s created. You can
  learn more about this in the <a href="https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/managing-repository-settings/managing-teams-and-people-with-access-to-your-repository">Managing your repositoryâ€™s settings and features</a> documentation.</p>

<ul>
<li><a href="https://git-scm.com/book/en/v2/Git-Basics-Getting-a-Git-Repository">Clone</a> your new repo to your local machine as you will need this later.</li>
</ul>
<h2 id="lab-pipeline">Lab Pipeline</h2>
<p>You will also need a devops pipeline to run your code. To create a pipeline, follow the steps below</p>

<ul>
<li><p>Create a pipeline in Azure Devops. In Azure DevOps, navigate to the HMCTS <a href="https://dev.azure.com/hmcts/PlatformOperations">Platform Operations</a> organisation. On the <code>Pipelines</code> menu, click on <code>Pipelines</code></p>

<details>
  <summary>HMCTS DevOps Organisation</summary>
  <img alt="HMCTS DevOps Organisation" src="./images/hmcts-devops-org.png" width="auto">
</details>

<details>
  <summary>Create new DevOps project</summary>
  <img alt="Create new Devops pipeline" src="./images/new-devops-pipeline.png" width="auto">
</details></li>
<li><p>Specify where you code repository is, in our case this would be Git</p>
<p><details>
   <summary>Specify Git repository</summary>
   <img alt="Specify Git repository" src="./images/new-devops-pipeline-2.png" width="auto">
 </details></p></li>
<li><p>Follow the relevant screens and prompts, select your lab repository in Git which would be an item in the repos listed after authentication
is complete. You may see screens similar to the once below</p>
<p><details>
   <summary>Create new pipeline</summary>
   <img alt="Create new pipeline" src="./images/new-devops-pipeline-3.png" width="auto">
 </details></p>
<p><details>
   <summary>Select new pipeline repo</summary>
   <img alt="Select new pipeline repo" src="./images/new-devops-pipeline-4.png" width="auto">
 </details></p>
<p><details>
   <summary>Authorise Azure DevOps</summary>
   <img alt="Authorise Azure DevOps" src="./images/new-devops-pipeline-5.png" width="auto">
 </details></p></li>
</ul>
<h2 id="build-your-resources">Build your resources</h2>
<p>To get your resources provisioned,  follow the steps below</p>

<ul>
<li>In the <a href="https://github.com/hmcts/goldenpath-platops/tree/master/lab-azure-resource">lab-azure-resource folder</a> copy all the files into your repo root folder.<br>
Your repo folder on your local machine should now look like this</li>
</ul>
<div class="highlight"><pre class="highlight markdown" tabindex="0"><code>  .
  â”œâ”€â”€ .gitignore
  â”œâ”€â”€ azure-pipelines.yaml
  â””â”€â”€ components
      â”œâ”€â”€ README.md
      â””â”€â”€ lab
          â”œâ”€â”€ main.tf
          â”œâ”€â”€ provider.tf
          â””â”€â”€ variables.tf
</code></pre></div>
<ul>
<li>Commit and push to your repo. This will trigger a devops pipeline run.</li>
</ul>
<h4 id="what-did-i-just-create">What did i just create?</h4>
<p>A lot has happened and is a good place to walk you through what&rsquo;s taken place so far</p>

<ul>
<li>If you have a look into the pipeline <code>yaml</code> file you will notice the following piece of config</li>
</ul>
<div class="highlight"><pre class="highlight yaml" tabindex="0"><code>  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">repositories</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">repository</span><span class="pi">:</span> <span class="s">cnp-azuredevops-libraries</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">github</span>
        <span class="na">ref</span><span class="pi">:</span> <span class="s">refs/heads/master</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">hmcts/cnp-azuredevops-libraries</span>
        <span class="na">endpoint</span><span class="pi">:</span> <span class="s1">'</span><span class="s">hmcts'</span>
</code></pre></div><p>This loads a central template resource that used in all our repos to provide base or required functionality that most pipelines need, you don&rsquo;t have to configure certain functionality from scratch, you simply reuse.</p>
<p>Have a look at the <a href="https://github.com/hmcts/cnp-azuredevops-libraries">cnp-azuredevops-libraries</a> repo to findout what capabilities this can give you in your other projects.</p>

<ul>
<li><p>You have all the terraform resource configuration that will spin up your lab resources</p></li>
<li><p>You dont need to manually run or define <code>plan</code> or <code>apply</code> stages why?&hellip; yes, you guessed right, because it&rsquo;s already configured in the <code>cnp-azuredevops-libraries</code>&lsquo;s <a href="https://github.com/hmcts/cnp-azuredevops-libraries/blob/master/steps/terraform.yaml">terraform</a> step.</p></li>
</ul>
<p>This is done by using the functionality as below</p>
<div class="highlight"><pre class="highlight yaml" tabindex="0"><code>  <span class="pi">-</span> <span class="na">stage</span><span class="pi">:</span> <span class="s">deploy</span>
    <span class="na">jobs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">job</span><span class="pi">:</span> <span class="s">PlanAndApply</span>
        <span class="na">steps</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">template</span><span class="pi">:</span> <span class="s">steps/terraform.yaml@cnp-azuredevops-libraries</span>
            <span class="na">parameters</span><span class="pi">:</span>
            <span class="s">...</span>
</code></pre></div><p>and pass in the required parameters</p>

<ul>
<li>Thank us later ðŸ˜‰, you now have a default template that you can always use as a starting point on most repo&rsquo;s you will create in the real world ðŸ˜Ž.</li>
</ul>
<h2 id="clean-up">Clean Up</h2>
<p>At the end of the exercise walk through you are required to delete these repository and pipeline as good practice ðŸ¤—.</p>
<p>More details in <a href="clean-up.html">Section 3 - Clean Up</a></p>

              <div data-module='page-expiry' data-last-reviewed-on="2023-09-14">
    <div class='page-expiry--not-expired'>
      This page was last reviewed on 14 July 2023.

        It needs to be reviewed again on 14 September 2023
        by the page owner <a href="https://hmcts-reform.slack.com/messages/platops-build-notices">platops-build-notices</a>
        .
    </div>

    <div class='page-expiry--expired'>
      This page was set to be reviewed before 14 September 2023
       by the page owner <a href="https://hmcts-reform.slack.com/messages/platops-build-notices">platops-build-notices</a>.
      This might mean the content is out of date.
    </div>
  </div>

          </main>

          <aside>
              <ul class="contribution-banner">
                <li><a href="https://github.com/hmcts/goldenpath-platops/blob/master/source/Walkthrough/prereq.html.md.erb">View source</a></li>
                <li><a href="https://github.com/hmcts/goldenpath-platops/issues/new?body=Problem+with+%27Lab+Repository+and+Pipeline%27+%28https%3A%2F%2Fhmcts-platops-goldenpath.github.io%2F%2FWalkthrough%2Fprereq.html%29&amp;labels=bug&amp;title=Re%3A+%27Lab+Repository+and+Pipeline%27">Report problem</a></li>
                <li><a href="https://github.com/hmcts/goldenpath-platops">GitHub Repo</a></li>
              </ul>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">


      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-170132988-1', 'auto');
  ga('set', 'anonymizeIp', true);
  ga('set', 'displayFeaturesTask', null);
  ga('set', 'transport', 'beacon');
  ga('set', 'page', location.pathname+location.search+location.hash);
  ga('send', 'pageview');
  </script>

    <script src="../javascripts/application.js"></script>
  </body>
</html>
